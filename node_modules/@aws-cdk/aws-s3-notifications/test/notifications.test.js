"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assert_1 = require("@aws-cdk/assert");
require("@aws-cdk/assert/jest");
const s3 = require("@aws-cdk/aws-s3");
const sns = require("@aws-cdk/aws-sns");
const cdk = require("@aws-cdk/core");
const s3n = require("../lib");
// tslint:disable:object-literal-key-quotes
// tslint:disable:max-line-length
test('bucket without notifications', () => {
    const stack = new cdk.Stack();
    new s3.Bucket(stack, 'MyBucket');
    expect(stack).toMatchTemplate({
        "Resources": {
            "MyBucketF68F3FF0": {
                "Type": "AWS::S3::Bucket",
                "DeletionPolicy": "Retain",
                "UpdateReplacePolicy": "Retain"
            }
        }
    });
});
test('when notification are added, a custom resource is provisioned + a lambda handler for it', () => {
    const stack = new cdk.Stack();
    const bucket = new s3.Bucket(stack, 'MyBucket');
    const topic = new sns.Topic(stack, 'MyTopic');
    bucket.addEventNotification(s3.EventType.OBJECT_CREATED, new s3n.SnsDestination(topic));
    expect(stack).toHaveResource('AWS::S3::Bucket');
    expect(stack).toHaveResource('AWS::Lambda::Function', { Description: 'AWS CloudFormation handler for "Custom::S3BucketNotifications" resources (@aws-cdk/aws-s3)' });
    expect(stack).toHaveResource('Custom::S3BucketNotifications');
});
test('when notification are added, you can tag the lambda', () => {
    const stack = new cdk.Stack();
    stack.node.applyAspect(new cdk.Tag('Lambda', 'AreTagged'));
    const bucket = new s3.Bucket(stack, 'MyBucket');
    const topic = new sns.Topic(stack, 'MyTopic');
    bucket.addEventNotification(s3.EventType.OBJECT_CREATED, new s3n.SnsDestination(topic));
    expect(stack).toHaveResource('AWS::S3::Bucket');
    expect(stack).toHaveResource('AWS::Lambda::Function', {
        Tags: [{ Key: 'Lambda', Value: 'AreTagged' }],
        Description: 'AWS CloudFormation handler for "Custom::S3BucketNotifications" resources (@aws-cdk/aws-s3)'
    });
    expect(stack).toHaveResource('Custom::S3BucketNotifications');
});
test('bucketNotificationTarget is not called during synthesis', () => {
    const stack = new cdk.Stack();
    // notice the order here - topic is defined before bucket
    // but this shouldn't impact the fact that the topic policy includes
    // the bucket information
    const topic = new sns.Topic(stack, 'Topic');
    const bucket = new s3.Bucket(stack, 'MyBucket');
    bucket.addObjectCreatedNotification(new s3n.SnsDestination(topic));
    expect(stack).toHaveResourceLike('AWS::SNS::TopicPolicy', {
        "Topics": [
            {
                "Ref": "TopicBFC7AF6E"
            }
        ],
        "PolicyDocument": {
            "Statement": [
                {
                    "Action": "sns:Publish",
                    "Condition": {
                        "ArnLike": {
                            "aws:SourceArn": {
                                "Fn::GetAtt": [
                                    "MyBucketF68F3FF0",
                                    "Arn"
                                ]
                            }
                        }
                    },
                    "Effect": "Allow",
                    "Principal": {
                        "Service": "s3.amazonaws.com"
                    },
                    "Resource": {
                        "Ref": "TopicBFC7AF6E"
                    },
                }
            ],
            "Version": "2012-10-17"
        }
    });
});
test('subscription types', () => {
    const stack = new cdk.Stack();
    const bucket = new s3.Bucket(stack, 'TestBucket');
    const queueTarget = {
        bind: _ => ({
            type: s3.BucketNotificationDestinationType.QUEUE,
            arn: 'arn:aws:sqs:...'
        })
    };
    const lambdaTarget = {
        bind: _ => ({
            type: s3.BucketNotificationDestinationType.LAMBDA,
            arn: 'arn:aws:lambda:...'
        })
    };
    const topicTarget = {
        bind: _ => ({
            type: s3.BucketNotificationDestinationType.TOPIC,
            arn: 'arn:aws:sns:...'
        })
    };
    bucket.addEventNotification(s3.EventType.OBJECT_CREATED, queueTarget);
    bucket.addEventNotification(s3.EventType.OBJECT_CREATED, lambdaTarget);
    bucket.addObjectRemovedNotification(topicTarget, { prefix: 'prefix' });
    expect(stack).toHaveResource('Custom::S3BucketNotifications', {
        "ServiceToken": {
            "Fn::GetAtt": [
                "BucketNotificationsHandler050a0587b7544547bf325f094a3db8347ECC3691",
                "Arn"
            ]
        },
        "BucketName": {
            "Ref": "TestBucket560B80BC"
        },
        "NotificationConfiguration": {
            "LambdaFunctionConfigurations": [
                {
                    "Events": [
                        "s3:ObjectCreated:*"
                    ],
                    "LambdaFunctionArn": "arn:aws:lambda:..."
                }
            ],
            "QueueConfigurations": [
                {
                    "Events": [
                        "s3:ObjectCreated:*"
                    ],
                    "QueueArn": "arn:aws:sqs:..."
                }
            ],
            "TopicConfigurations": [
                {
                    "Events": [
                        "s3:ObjectRemoved:*"
                    ],
                    "TopicArn": "arn:aws:sns:...",
                    "Filter": {
                        "Key": {
                            "FilterRules": [
                                {
                                    "Name": "prefix",
                                    "Value": "prefix"
                                }
                            ]
                        }
                    }
                }
            ]
        }
    });
});
test('multiple subscriptions of the same type', () => {
    const stack = new cdk.Stack();
    const bucket = new s3.Bucket(stack, 'TestBucket');
    bucket.addEventNotification(s3.EventType.OBJECT_REMOVED_DELETE, {
        bind: _ => ({
            type: s3.BucketNotificationDestinationType.QUEUE,
            arn: 'arn:aws:sqs:...:queue1'
        })
    });
    bucket.addEventNotification(s3.EventType.OBJECT_REMOVED_DELETE, {
        bind: _ => ({
            type: s3.BucketNotificationDestinationType.QUEUE,
            arn: 'arn:aws:sqs:...:queue2'
        })
    });
    expect(stack).toHaveResource('Custom::S3BucketNotifications', {
        "ServiceToken": {
            "Fn::GetAtt": [
                "BucketNotificationsHandler050a0587b7544547bf325f094a3db8347ECC3691",
                "Arn"
            ]
        },
        "BucketName": {
            "Ref": "TestBucket560B80BC"
        },
        "NotificationConfiguration": {
            "QueueConfigurations": [
                {
                    "Events": [
                        "s3:ObjectRemoved:Delete"
                    ],
                    "QueueArn": "arn:aws:sqs:...:queue1"
                },
                {
                    "Events": [
                        "s3:ObjectRemoved:Delete"
                    ],
                    "QueueArn": "arn:aws:sqs:...:queue2"
                }
            ]
        }
    });
});
test('prefix/suffix filters', () => {
    const stack = new cdk.Stack();
    const bucket = new s3.Bucket(stack, 'TestBucket');
    const bucketNotificationTarget = {
        type: s3.BucketNotificationDestinationType.QUEUE,
        arn: 'arn:aws:sqs:...'
    };
    bucket.addEventNotification(s3.EventType.OBJECT_REMOVED_DELETE, { bind: _ => bucketNotificationTarget }, { prefix: 'images/', suffix: '.jpg' });
    expect(stack).toHaveResource('Custom::S3BucketNotifications', {
        "ServiceToken": {
            "Fn::GetAtt": [
                "BucketNotificationsHandler050a0587b7544547bf325f094a3db8347ECC3691",
                "Arn"
            ]
        },
        "BucketName": {
            "Ref": "TestBucket560B80BC"
        },
        "NotificationConfiguration": {
            "QueueConfigurations": [
                {
                    "Events": [
                        "s3:ObjectRemoved:Delete"
                    ],
                    "Filter": {
                        "Key": {
                            "FilterRules": [
                                {
                                    "Name": "suffix",
                                    "Value": ".jpg"
                                },
                                {
                                    "Name": "prefix",
                                    "Value": "images/"
                                }
                            ]
                        }
                    },
                    "QueueArn": "arn:aws:sqs:..."
                }
            ]
        }
    });
});
test('a notification destination can specify a set of dependencies that must be resolved before the notifications resource is created', () => {
    const stack = new cdk.Stack();
    const bucket = new s3.Bucket(stack, 'Bucket');
    const dependent = new cdk.CfnResource(stack, 'Dependent', { type: 'DependOnMe' });
    const dest = {
        bind: () => ({
            arn: 'arn',
            type: s3.BucketNotificationDestinationType.QUEUE,
            dependencies: [dependent]
        })
    };
    bucket.addObjectCreatedNotification(dest);
    cdk.ConstructNode.prepare(stack.node);
    expect(assert_1.SynthUtils.synthesize(stack).template.Resources.BucketNotifications8F2E257D).toEqual({
        Type: 'Custom::S3BucketNotifications',
        Properties: {
            ServiceToken: { 'Fn::GetAtt': ['BucketNotificationsHandler050a0587b7544547bf325f094a3db8347ECC3691', 'Arn'] },
            BucketName: { Ref: 'Bucket83908E77' },
            NotificationConfiguration: { QueueConfigurations: [{ Events: ['s3:ObjectCreated:*'], QueueArn: 'arn' }] }
        },
        DependsOn: ['Dependent']
    });
});
describe('CloudWatch Events', () => {
    test('onCloudTrailPutObject contains the Bucket ARN itself when path is undefined', () => {
        const stack = new cdk.Stack();
        const bucket = s3.Bucket.fromBucketAttributes(stack, 'Bucket', {
            bucketName: 'MyBucket',
        });
        bucket.onCloudTrailPutObject('PutRule', {
            target: {
                bind: () => ({ arn: 'ARN', id: '' })
            }
        });
        expect(stack).toHaveResourceLike('AWS::Events::Rule', {
            "EventPattern": {
                "source": [
                    "aws.s3",
                ],
                "detail": {
                    "eventName": [
                        "PutObject",
                    ],
                    "resources": {
                        "ARN": [
                            {
                                "Fn::Join": [
                                    "",
                                    [
                                        "arn:",
                                        {
                                            "Ref": "AWS::Partition",
                                        },
                                        ":s3:::MyBucket",
                                    ],
                                ],
                            },
                        ],
                    },
                },
            },
            "State": "ENABLED",
        });
    });
    test("onCloudTrailPutObject contains the path when it's provided", () => {
        const stack = new cdk.Stack();
        const bucket = s3.Bucket.fromBucketAttributes(stack, 'Bucket', {
            bucketName: 'MyBucket',
        });
        bucket.onCloudTrailPutObject('PutRule', {
            target: {
                bind: () => ({ arn: 'ARN', id: '' })
            },
            paths: ['my/path.zip']
        });
        expect(stack).toHaveResourceLike('AWS::Events::Rule', {
            "EventPattern": {
                "source": [
                    "aws.s3",
                ],
                "detail": {
                    "eventName": [
                        "PutObject",
                    ],
                    "resources": {
                        "ARN": [
                            {
                                "Fn::Join": [
                                    "",
                                    [
                                        "arn:",
                                        {
                                            "Ref": "AWS::Partition",
                                        },
                                        ":s3:::MyBucket/my/path.zip"
                                    ],
                                ],
                            },
                        ],
                    },
                },
            },
            "State": "ENABLED",
        });
    });
    test("onCloudTrailWriteObject matches on events CompleteMultipartUpload, CopyObject, and PutObject", () => {
        const stack = new cdk.Stack();
        const bucket = s3.Bucket.fromBucketAttributes(stack, 'Bucket', {
            bucketName: 'MyBucket',
        });
        bucket.onCloudTrailWriteObject('OnCloudTrailWriteObjectRule', {
            target: {
                bind: () => ({ arn: 'ARN', id: '' })
            }
        });
        expect(stack).toHaveResourceLike('AWS::Events::Rule', {
            "EventPattern": {
                "source": [
                    "aws.s3",
                ],
                "detail": {
                    "eventName": [
                        "CompleteMultipartUpload",
                        "CopyObject",
                        "PutObject",
                    ],
                },
            },
            "State": "ENABLED",
        });
    });
    test('onCloudTrailWriteObject matches on the requestParameter bucketName when the path is not provided', () => {
        const stack = new cdk.Stack();
        const bucket = s3.Bucket.fromBucketAttributes(stack, 'Bucket', {
            bucketName: 'MyBucket',
        });
        bucket.onCloudTrailWriteObject('OnCloudTrailWriteObjectRule', {
            target: {
                bind: () => ({ arn: 'ARN', id: '' })
            },
        });
        expect(stack).toHaveResourceLike('AWS::Events::Rule', {
            "EventPattern": {
                "source": [
                    "aws.s3",
                ],
                "detail": {
                    "requestParameters": {
                        "bucketName": [
                            bucket.bucketName,
                        ],
                    },
                },
            },
        });
    });
    test("onCloudTrailWriteObject matches on the requestParameters bucketName and key when the path is provided", () => {
        const stack = new cdk.Stack();
        const bucket = s3.Bucket.fromBucketAttributes(stack, 'Bucket', {
            bucketName: 'MyBucket',
        });
        bucket.onCloudTrailWriteObject('OnCloudTrailWriteObjectRule', {
            target: {
                bind: () => ({ arn: 'ARN', id: '' })
            },
            paths: ['my/path.zip']
        });
        expect(stack).toHaveResourceLike('AWS::Events::Rule', {
            "EventPattern": {
                "source": [
                    "aws.s3",
                ],
                "detail": {
                    "requestParameters": {
                        "bucketName": [
                            bucket.bucketName,
                        ],
                        "key": [
                            "my/path.zip",
                        ],
                    },
                },
            },
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9ucy50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibm90aWZpY2F0aW9ucy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsNENBQTZDO0FBQzdDLGdDQUE4QjtBQUM5QixzQ0FBc0M7QUFDdEMsd0NBQXdDO0FBQ3hDLHFDQUFxQztBQUNyQyw4QkFBOEI7QUFFOUIsMkNBQTJDO0FBQzNDLGlDQUFpQztBQUVqQyxJQUFJLENBQUMsOEJBQThCLEVBQUUsR0FBRyxFQUFFO0lBQ3hDLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBRTlCLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFFakMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLGVBQWUsQ0FBQztRQUM1QixXQUFXLEVBQUU7WUFDWCxrQkFBa0IsRUFBRTtnQkFDbEIsTUFBTSxFQUFFLGlCQUFpQjtnQkFDekIsZ0JBQWdCLEVBQUUsUUFBUTtnQkFDMUIscUJBQXFCLEVBQUUsUUFBUTthQUNoQztTQUNGO0tBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMseUZBQXlGLEVBQUUsR0FBRyxFQUFFO0lBQ25HLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBRTlCLE1BQU0sTUFBTSxHQUFHLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDaEQsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxTQUFTLENBQUMsQ0FBQztJQUU5QyxNQUFNLENBQUMsb0JBQW9CLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxjQUFjLEVBQUUsSUFBSSxHQUFHLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFFeEYs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LEVBQUU7Z0JBQ04sSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQzthQUNyQztZQUNELEtBQUssRUFBRSxDQUFDLGFBQWEsQ0FBQztTQUN2QixDQUFDLENBQUM7UUFFSCxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsa0JBQWtCLENBQUMsbUJBQW1CLEVBQUU7WUFDcEQsY0FBYyxFQUFFO2dCQUNkLFFBQVEsRUFBRTtvQkFDUixRQUFRO2lCQUNUO2dCQUNELFFBQVEsRUFBRTtvQkFDUixtQkFBbUIsRUFBRTt3QkFDbkIsWUFBWSxFQUFFOzRCQUNaLE1BQU0sQ0FBQyxVQUFVO3lCQUNsQjt3QkFDRCxLQUFLLEVBQUU7NEJBQ0wsYUFBYTt5QkFDZDtxQkFDRjtpQkFDRjthQUNGO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN5bnRoVXRpbHMgfSBmcm9tICdAYXdzLWNkay9hc3NlcnQnO1xuaW1wb3J0ICdAYXdzLWNkay9hc3NlcnQvamVzdCc7XG5pbXBvcnQgKiBhcyBzMyBmcm9tICdAYXdzLWNkay9hd3MtczMnO1xuaW1wb3J0ICogYXMgc25zIGZyb20gJ0Bhd3MtY2RrL2F3cy1zbnMnO1xuaW1wb3J0ICogYXMgY2RrIGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xuaW1wb3J0ICogYXMgczNuIGZyb20gJy4uL2xpYic7XG5cbi8vIHRzbGludDpkaXNhYmxlOm9iamVjdC1saXRlcmFsLWtleS1xdW90ZXNcbi8vIHRzbGludDpkaXNhYmxlOm1heC1saW5lLWxlbmd0aFxuXG50ZXN0KCdidWNrZXQgd2l0aG91dCBub3RpZmljYXRpb25zJywgKCkgPT4ge1xuICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICBuZXcgczMuQnVja2V0KHN0YWNrLCAnTXlCdWNrZXQnKTtcblxuICBleHBlY3Qoc3RhY2spLnRvTWF0Y2hUZW1wbGF0ZSh7XG4gICAgXCJSZXNvdXJjZXNcIjoge1xuICAgICAgXCJNeUJ1Y2tldEY2OEYzRkYwXCI6IHtcbiAgICAgICAgXCJUeXBlXCI6IFwiQVdTOjpTMzo6QnVja2V0XCIsXG4gICAgICAgIFwiRGVsZXRpb25Qb2xpY3lcIjogXCJSZXRhaW5cIixcbiAgICAgICAgXCJVcGRhdGVSZXBsYWNlUG9saWN5XCI6IFwiUmV0YWluXCJcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufSk7XG5cbnRlc3QoJ3doZW4gbm90aWZpY2F0aW9uIGFyZSBhZGRlZCwgYSBjdXN0b20gcmVzb3VyY2UgaXMgcHJvdmlzaW9uZWQgKyBhIGxhbWJkYSBoYW5kbGVyIGZvciBpdCcsICgpID0+IHtcbiAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG5cbiAgY29uc3QgYnVja2V0ID0gbmV3IHMzLkJ1Y2tldChzdGFjaywgJ015QnVja2V0Jyk7XG4gIGNvbnN0IHRvcGljID0gbmV3IHNucy5Ub3BpYyhzdGFjaywgJ015VG9waWMnKTtcblxuICBidWNrZXQuYWRkRXZlbnROb3RpZmljYXRpb24oczMuRXZlbnRUeXBlLk9CSkVDVF9DUkVBVEVELCBuZXcgczNuLlNuc0Rlc3RpbmF0aW9uKHRvcGljKSk7XG5cbiAgZXhwZWN0KHN0YWNrKS50b0hhdmVSZXNvdXJjZSgnQVdTOjpTMzo6QnVja2V0Jyk7XG4gIGV4cGVjdChzdGFjaykudG9IYXZlUmVzb3VyY2UoJ0FXUzo6TGFtYmRhOjpGdW5jdGlvbicsIHsgRGVzY3JpcHRpb246ICdBV1MgQ2xvdWRGb3JtYXRpb24gaGFuZGxlciBmb3IgXCJDdXN0b206OlMzQnVja2V0Tm90aWZpY2F0aW9uc1wiIHJlc291cmNlcyAoQGF3cy1jZGsvYXdzLXMzKScgfSk7XG4gIGV4cGVjdChzdGFjaykudG9IYXZlUmVzb3VyY2UoJ0N1c3RvbTo6UzNCdWNrZXROb3RpZmljYXRpb25zJyk7XG59KTtcblxudGVzdCgnd2hlbiBub3RpZmljYXRpb24gYXJlIGFkZGVkLCB5b3UgY2FuIHRhZyB0aGUgbGFtYmRhJywgKCkgPT4ge1xuICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgc3RhY2subm9kZS5hcHBseUFzcGVjdChuZXcgY2RrLlRhZygnTGFtYmRhJywgJ0FyZVRhZ2dlZCcpKTtcblxuICBjb25zdCBidWNrZXQgPSBuZXcgczMuQnVja2V0KHN0YWNrLCAnTXlCdWNrZXQnKTtcblxuICBjb25zdCB0b3BpYyA9IG5ldyBzbnMuVG9waWMoc3RhY2ssICdNeVRvcGljJyk7XG5cbiAgYnVja2V0LmFkZEV2ZW50Tm90aWZpY2F0aW9uKHMzLkV2ZW50VHlwZS5PQkpFQ1RfQ1JFQVRFRCwgbmV3IHMzbi5TbnNEZXN0aW5hdGlvbih0b3BpYykpO1xuXG4gIGV4cGVjdChzdGFjaykudG9IYXZlUmVzb3VyY2UoJ0FXUzo6UzM6OkJ1Y2tldCcpO1xuICBleHBlY3Qoc3RhY2spLnRvSGF2ZVJlc291cmNlKCdBV1M6OkxhbWJkYTo6RnVuY3Rpb24nLCB7XG4gICAgVGFnczogW3tLZXk6ICdMYW1iZGEnLCBWYWx1ZTogJ0FyZVRhZ2dlZCd9XSxcbiAgICBEZXNjcmlwdGlvbjogJ0FXUyBDbG91ZEZvcm1hdGlvbiBoYW5kbGVyIGZvciBcIkN1c3RvbTo6UzNCdWNrZXROb3RpZmljYXRpb25zXCIgcmVzb3VyY2VzIChAYXdzLWNkay9hd3MtczMpJyB9KTtcbiAgZXhwZWN0KHN0YWNrKS50b0hhdmVSZXNvdXJjZSgnQ3VzdG9tOjpTM0J1Y2tldE5vdGlmaWNhdGlvbnMnKTtcbn0pO1xuXG50ZXN0KCdidWNrZXROb3RpZmljYXRpb25UYXJnZXQgaXMgbm90IGNhbGxlZCBkdXJpbmcgc3ludGhlc2lzJywgKCkgPT4ge1xuICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAvLyBub3RpY2UgdGhlIG9yZGVyIGhlcmUgLSB0b3BpYyBpcyBkZWZpbmVkIGJlZm9yZSBidWNrZXRcbiAgLy8gYnV0IHRoaXMgc2hvdWxkbid0IGltcGFjdCB0aGUgZmFjdCB0aGF0IHRoZSB0b3BpYyBwb2xpY3kgaW5jbHVkZXNcbiAgLy8gdGhlIGJ1Y2tldCBpbmZvcm1hdGlvblxuICBjb25zdCB0b3BpYyA9IG5ldyBzbnMuVG9waWMoc3RhY2ssICdUb3BpYycpO1xuICBjb25zdCBidWNrZXQgPSBuZXcgczMuQnVja2V0KHN0YWNrLCAnTXlCdWNrZXQnKTtcblxuICBidWNrZXQuYWRkT2JqZWN0Q3JlYXRlZE5vdGlmaWNhdGlvbihuZXcgczNuLlNuc0Rlc3RpbmF0aW9uKHRvcGljKSk7XG5cbiAgZXhwZWN0KHN0YWNrKS50b0hhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6U05TOjpUb3BpY1BvbGljeScsIHtcbiAgICBcIlRvcGljc1wiOiBbXG4gICAge1xuICAgICAgXCJSZWZcIjogXCJUb3BpY0JGQzdBRjZFXCJcbiAgICB9XG4gICAgXSxcbiAgICBcIlBvbGljeURvY3VtZW50XCI6IHtcbiAgICBcIlN0YXRlbWVudFwiOiBbXG4gICAgICB7XG4gICAgICBcIkFjdGlvblwiOiBcInNuczpQdWJsaXNoXCIsXG4gICAgICBcIkNvbmRpdGlvblwiOiB7XG4gICAgICAgIFwiQXJuTGlrZVwiOiB7XG4gICAgICAgIFwiYXdzOlNvdXJjZUFyblwiOiB7XG4gICAgICAgICAgXCJGbjo6R2V0QXR0XCI6IFtcbiAgICAgICAgICBcIk15QnVja2V0RjY4RjNGRjBcIixcbiAgICAgICAgICBcIkFyblwiXG4gICAgICAgICAgXVxuICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBcIkVmZmVjdFwiOiBcIkFsbG93XCIsXG4gICAgICBcIlByaW5jaXBhbFwiOiB7XG4gICAgICAgIFwiU2VydmljZVwiOiBcInMzLmFtYXpvbmF3cy5jb21cIlxuICAgICAgfSxcbiAgICAgIFwiUmVzb3VyY2VcIjoge1xuICAgICAgICBcIlJlZlwiOiBcIlRvcGljQkZDN0FGNkVcIlxuICAgICAgfSxcbiAgICAgIH1cbiAgICBdLFxuICAgIFwiVmVyc2lvblwiOiBcIjIwMTItMTAtMTdcIlxuICAgIH1cbiAgfSk7XG59KTtcblxudGVzdCgnc3Vic2NyaXB0aW9uIHR5cGVzJywgKCkgPT4ge1xuICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICBjb25zdCBidWNrZXQgPSBuZXcgczMuQnVja2V0KHN0YWNrLCAnVGVzdEJ1Y2tldCcpO1xuXG4gIGNvbnN0IHF1ZXVlVGFyZ2V0OiBzMy5JQnVja2V0Tm90aWZpY2F0aW9uRGVzdGluYXRpb24gPSB7XG4gICAgYmluZDogXyA9PiAoe1xuICAgICAgdHlwZTogczMuQnVja2V0Tm90aWZpY2F0aW9uRGVzdGluYXRpb25UeXBlLlFVRVVFLFxuICAgICAgYXJuOiAnYXJuOmF3czpzcXM6Li4uJ1xuICAgIH0pXG4gIH07XG5cbiAgY29uc3QgbGFtYmRhVGFyZ2V0OiBzMy5JQnVja2V0Tm90aWZpY2F0aW9uRGVzdGluYXRpb24gPSB7XG4gICAgYmluZDogXyA9PiAoe1xuICAgICAgdHlwZTogczMuQnVja2V0Tm90aWZpY2F0aW9uRGVzdGluYXRpb25UeXBlLkxBTUJEQSxcbiAgICAgIGFybjogJ2Fybjphd3M6bGFtYmRhOi4uLidcbiAgICB9KVxuICB9O1xuXG4gIGNvbnN0IHRvcGljVGFyZ2V0OiBzMy5JQnVja2V0Tm90aWZpY2F0aW9uRGVzdGluYXRpb24gPSB7XG4gICAgYmluZDogXyA9PiAoe1xuICAgICAgdHlwZTogczMuQnVja2V0Tm90aWZpY2F0aW9uRGVzdGluYXRpb25UeXBlLlRPUElDLFxuICAgICAgYXJuOiAnYXJuOmF3czpzbnM6Li4uJ1xuICAgIH0pXG4gIH07XG5cbiAgYnVja2V0LmFkZEV2ZW50Tm90aWZpY2F0aW9uKHMzLkV2ZW50VHlwZS5PQkpFQ1RfQ1JFQVRFRCwgcXVldWVUYXJnZXQpO1xuICBidWNrZXQuYWRkRXZlbnROb3RpZmljYXRpb24oczMuRXZlbnRUeXBlLk9CSkVDVF9DUkVBVEVELCBsYW1iZGFUYXJnZXQpO1xuICBidWNrZXQuYWRkT2JqZWN0UmVtb3ZlZE5vdGlmaWNhdGlvbih0b3BpY1RhcmdldCwgeyBwcmVmaXg6ICdwcmVmaXgnIH0pO1xuXG4gIGV4cGVjdChzdGFjaykudG9IYXZlUmVzb3VyY2UoJ0N1c3RvbTo6UzNCdWNrZXROb3RpZmljYXRpb25zJywge1xuICAgIFwiU2VydmljZVRva2VuXCI6IHtcbiAgICBcIkZuOjpHZXRBdHRcIjogW1xuICAgICAgXCJCdWNrZXROb3RpZmljYXRpb25zSGFuZGxlcjA1MGEwNTg3Yjc1NDQ1NDdiZjMyNWYwOTRhM2RiODM0N0VDQzM2OTFcIixcbiAgICAgIFwiQXJuXCJcbiAgICBdXG4gICAgfSxcbiAgICBcIkJ1Y2tldE5hbWVcIjoge1xuICAgIFwiUmVmXCI6IFwiVGVzdEJ1Y2tldDU2MEI4MEJDXCJcbiAgICB9LFxuICAgIFwiTm90aWZpY2F0aW9uQ29uZmlndXJhdGlvblwiOiB7XG4gICAgXCJMYW1iZGFGdW5jdGlvbkNvbmZpZ3VyYXRpb25zXCI6IFtcbiAgICAgIHtcbiAgICAgIFwiRXZlbnRzXCI6IFtcbiAgICAgICAgXCJzMzpPYmplY3RDcmVhdGVkOipcIlxuICAgICAgXSxcbiAgICAgIFwiTGFtYmRhRnVuY3Rpb25Bcm5cIjogXCJhcm46YXdzOmxhbWJkYTouLi5cIlxuICAgICAgfVxuICAgIF0sXG4gICAgXCJRdWV1ZUNvbmZpZ3VyYXRpb25zXCI6IFtcbiAgICAgIHtcbiAgICAgIFwiRXZlbnRzXCI6IFtcbiAgICAgICAgXCJzMzpPYmplY3RDcmVhdGVkOipcIlxuICAgICAgXSxcbiAgICAgIFwiUXVldWVBcm5cIjogXCJhcm46YXdzOnNxczouLi5cIlxuICAgICAgfVxuICAgIF0sXG4gICAgXCJUb3BpY0NvbmZpZ3VyYXRpb25zXCI6IFtcbiAgICAgIHtcbiAgICAgIFwiRXZlbnRzXCI6IFtcbiAgICAgICAgXCJzMzpPYmplY3RSZW1vdmVkOipcIlxuICAgICAgXSxcbiAgICAgIFwiVG9waWNBcm5cIjogXCJhcm46YXdzOnNuczouLi5cIixcbiAgICAgIFwiRmlsdGVyXCI6IHtcbiAgICAgICAgXCJLZXlcIjoge1xuICAgICAgICBcIkZpbHRlclJ1bGVzXCI6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgXCJOYW1lXCI6IFwicHJlZml4XCIsXG4gICAgICAgICAgXCJWYWx1ZVwiOiBcInByZWZpeFwiXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIH1cbiAgICBdXG4gICAgfVxuICB9KTtcbn0pO1xuXG50ZXN0KCdtdWx0aXBsZSBzdWJzY3JpcHRpb25zIG9mIHRoZSBzYW1lIHR5cGUnLCAoKSA9PiB7XG4gIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gIGNvbnN0IGJ1Y2tldCA9IG5ldyBzMy5CdWNrZXQoc3RhY2ssICdUZXN0QnVja2V0Jyk7XG5cbiAgYnVja2V0LmFkZEV2ZW50Tm90aWZpY2F0aW9uKHMzLkV2ZW50VHlwZS5PQkpFQ1RfUkVNT1ZFRF9ERUxFVEUsIHtcbiAgICBiaW5kOiBfID0+ICh7XG4gICAgICB0eXBlOiBzMy5CdWNrZXROb3RpZmljYXRpb25EZXN0aW5hdGlvblR5cGUuUVVFVUUsXG4gICAgICBhcm46ICdhcm46YXdzOnNxczouLi46cXVldWUxJ1xuICAgIH0pXG4gIH0pO1xuXG4gIGJ1Y2tldC5hZGRFdmVudE5vdGlmaWNhdGlvbihzMy5FdmVudFR5cGUuT0JKRUNUX1JFTU9WRURfREVMRVRFLCB7XG4gICAgYmluZDogXyA9PiAoe1xuICAgICAgdHlwZTogczMuQnVja2V0Tm90aWZpY2F0aW9uRGVzdGluYXRpb25UeXBlLlFVRVVFLFxuICAgICAgYXJuOiAnYXJuOmF3czpzcXM6Li4uOnF1ZXVlMidcbiAgICB9KVxuICB9KTtcblxuICBleHBlY3Qoc3RhY2spLnRvSGF2ZVJlc291cmNlKCdDdXN0b206OlMzQnVja2V0Tm90aWZpY2F0aW9ucycsIHtcbiAgICBcIlNlcnZpY2VUb2tlblwiOiB7XG4gICAgXCJGbjo6R2V0QXR0XCI6IFtcbiAgICAgIFwiQnVja2V0Tm90aWZpY2F0aW9uc0hhbmRsZXIwNTBhMDU4N2I3NTQ0NTQ3YmYzMjVmMDk0YTNkYjgzNDdFQ0MzNjkxXCIsXG4gICAgICBcIkFyblwiXG4gICAgXVxuICAgIH0sXG4gICAgXCJCdWNrZXROYW1lXCI6IHtcbiAgICBcIlJlZlwiOiBcIlRlc3RCdWNrZXQ1NjBCODBCQ1wiXG4gICAgfSxcbiAgICBcIk5vdGlmaWNhdGlvbkNvbmZpZ3VyYXRpb25cIjoge1xuICAgIFwiUXVldWVDb25maWd1cmF0aW9uc1wiOiBbXG4gICAgICB7XG4gICAgICBcIkV2ZW50c1wiOiBbXG4gICAgICAgIFwiczM6T2JqZWN0UmVtb3ZlZDpEZWxldGVcIlxuICAgICAgXSxcbiAgICAgIFwiUXVldWVBcm5cIjogXCJhcm46YXdzOnNxczouLi46cXVldWUxXCJcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICBcIkV2ZW50c1wiOiBbXG4gICAgICAgIFwiczM6T2JqZWN0UmVtb3ZlZDpEZWxldGVcIlxuICAgICAgXSxcbiAgICAgIFwiUXVldWVBcm5cIjogXCJhcm46YXdzOnNxczouLi46cXVldWUyXCJcbiAgICAgIH1cbiAgICBdXG4gICAgfVxuICB9KTtcbn0pO1xuXG50ZXN0KCdwcmVmaXgvc3VmZml4IGZpbHRlcnMnLCAoKSA9PiB7XG4gIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gIGNvbnN0IGJ1Y2tldCA9IG5ldyBzMy5CdWNrZXQoc3RhY2ssICdUZXN0QnVja2V0Jyk7XG5cbiAgY29uc3QgYnVja2V0Tm90aWZpY2F0aW9uVGFyZ2V0ID0ge1xuICAgIHR5cGU6IHMzLkJ1Y2tldE5vdGlmaWNhdGlvbkRlc3RpbmF0aW9uVHlwZS5RVUVVRSxcbiAgICBhcm46ICdhcm46YXdzOnNxczouLi4nXG4gIH07XG5cbiAgYnVja2V0LmFkZEV2ZW50Tm90aWZpY2F0aW9uKHMzLkV2ZW50VHlwZS5PQkpFQ1RfUkVNT1ZFRF9ERUxFVEUsIHsgYmluZDogXyA9PiBidWNrZXROb3RpZmljYXRpb25UYXJnZXQgfSwgeyBwcmVmaXg6ICdpbWFnZXMvJywgc3VmZml4OiAnLmpwZycgfSk7XG5cbiAgZXhwZWN0KHN0YWNrKS50b0hhdmVSZXNvdXJjZSgnQ3VzdG9tOjpTM0J1Y2tldE5vdGlmaWNhdGlvbnMnLCB7XG4gICAgXCJTZXJ2aWNlVG9rZW5cIjoge1xuICAgIFwiRm46OkdldEF0dFwiOiBbXG4gICAgICBcIkJ1Y2tldE5vdGlmaWNhdGlvbnNIYW5kbGVyMDUwYTA1ODdiNzU0NDU0N2JmMzI1ZjA5NGEzZGI4MzQ3RUNDMzY5MVwiLFxuICAgICAgXCJBcm5cIlxuICAgIF1cbiAgICB9LFxuICAgIFwiQnVja2V0TmFtZVwiOiB7XG4gICAgXCJSZWZcIjogXCJUZXN0QnVja2V0NTYwQjgwQkNcIlxuICAgIH0sXG4gICAgXCJOb3RpZmljYXRpb25Db25maWd1cmF0aW9uXCI6IHtcbiAgICBcIlF1ZXVlQ29uZmlndXJhdGlvbnNcIjogW1xuICAgICAge1xuICAgICAgXCJFdmVudHNcIjogW1xuICAgICAgICBcInMzOk9iamVjdFJlbW92ZWQ6RGVsZXRlXCJcbiAgICAgIF0sXG4gICAgICBcIkZpbHRlclwiOiB7XG4gICAgICAgIFwiS2V5XCI6IHtcbiAgICAgICAgXCJGaWx0ZXJSdWxlc1wiOiBbXG4gICAgICAgICAge1xuICAgICAgICAgIFwiTmFtZVwiOiBcInN1ZmZpeFwiLFxuICAgICAgICAgIFwiVmFsdWVcIjogXCIuanBnXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICBcIk5hbWVcIjogXCJwcmVmaXhcIixcbiAgICAgICAgICBcIlZhbHVlXCI6IFwiaW1hZ2VzL1wiXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBcIlF1ZXVlQXJuXCI6IFwiYXJuOmF3czpzcXM6Li4uXCJcbiAgICAgIH1cbiAgICBdXG4gICAgfVxuICB9KTtcbn0pO1xuXG50ZXN0KCdhIG5vdGlmaWNhdGlvbiBkZXN0aW5hdGlvbiBjYW4gc3BlY2lmeSBhIHNldCBvZiBkZXBlbmRlbmNpZXMgdGhhdCBtdXN0IGJlIHJlc29sdmVkIGJlZm9yZSB0aGUgbm90aWZpY2F0aW9ucyByZXNvdXJjZSBpcyBjcmVhdGVkJywgKCkgPT4ge1xuICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICBjb25zdCBidWNrZXQgPSBuZXcgczMuQnVja2V0KHN0YWNrLCAnQnVja2V0Jyk7XG4gIGNvbnN0IGRlcGVuZGVudCA9IG5ldyBjZGsuQ2ZuUmVzb3VyY2Uoc3RhY2ssICdEZXBlbmRlbnQnLCB7IHR5cGU6ICdEZXBlbmRPbk1lJyB9KTtcbiAgY29uc3QgZGVzdDogczMuSUJ1Y2tldE5vdGlmaWNhdGlvbkRlc3RpbmF0aW9uID0ge1xuICAgIGJpbmQ6ICgpID0+ICh7XG4gICAgICBhcm46ICdhcm4nLFxuICAgICAgdHlwZTogczMuQnVja2V0Tm90aWZpY2F0aW9uRGVzdGluYXRpb25UeXBlLlFVRVVFLFxuICAgICAgZGVwZW5kZW5jaWVzOiBbIGRlcGVuZGVudCBdXG4gICAgfSlcbiAgfTtcblxuICBidWNrZXQuYWRkT2JqZWN0Q3JlYXRlZE5vdGlmaWNhdGlvbihkZXN0KTtcblxuICBjZGsuQ29uc3RydWN0Tm9kZS5wcmVwYXJlKHN0YWNrLm5vZGUpO1xuXG4gIGV4cGVjdChTeW50aFV0aWxzLnN5bnRoZXNpemUoc3RhY2spLnRlbXBsYXRlLlJlc291cmNlcy5CdWNrZXROb3RpZmljYXRpb25zOEYyRTI1N0QpLnRvRXF1YWwoe1xuICAgIFR5cGU6ICdDdXN0b206OlMzQnVja2V0Tm90aWZpY2F0aW9ucycsXG4gICAgUHJvcGVydGllczoge1xuICAgICAgU2VydmljZVRva2VuOiB7ICdGbjo6R2V0QXR0JzogWyAnQnVja2V0Tm90aWZpY2F0aW9uc0hhbmRsZXIwNTBhMDU4N2I3NTQ0NTQ3YmYzMjVmMDk0YTNkYjgzNDdFQ0MzNjkxJywgJ0FybicgXSB9LFxuICAgICAgQnVja2V0TmFtZTogeyBSZWY6ICdCdWNrZXQ4MzkwOEU3NycgfSxcbiAgICAgIE5vdGlmaWNhdGlvbkNvbmZpZ3VyYXRpb246IHsgUXVldWVDb25maWd1cmF0aW9uczogWyB7IEV2ZW50czogWyAnczM6T2JqZWN0Q3JlYXRlZDoqJyBdLCBRdWV1ZUFybjogJ2FybicgfSBdIH1cbiAgICB9LFxuICAgIERlcGVuZHNPbjogWyAnRGVwZW5kZW50JyBdXG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdDbG91ZFdhdGNoIEV2ZW50cycsICgpID0+IHtcbiAgdGVzdCgnb25DbG91ZFRyYWlsUHV0T2JqZWN0IGNvbnRhaW5zIHRoZSBCdWNrZXQgQVJOIGl0c2VsZiB3aGVuIHBhdGggaXMgdW5kZWZpbmVkJywgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICAgIGNvbnN0IGJ1Y2tldCA9IHMzLkJ1Y2tldC5mcm9tQnVja2V0QXR0cmlidXRlcyhzdGFjaywgJ0J1Y2tldCcsIHtcbiAgICAgIGJ1Y2tldE5hbWU6ICdNeUJ1Y2tldCcsXG4gICAgfSk7XG4gICAgYnVja2V0Lm9uQ2xvdWRUcmFpbFB1dE9iamVjdCgnUHV0UnVsZScsIHtcbiAgICAgIHRhcmdldDoge1xuICAgICAgICBiaW5kOiAoKSA9PiAoeyBhcm46ICdBUk4nLCBpZDogJycgfSlcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGV4cGVjdChzdGFjaykudG9IYXZlUmVzb3VyY2VMaWtlKCdBV1M6OkV2ZW50czo6UnVsZScsIHtcbiAgICAgIFwiRXZlbnRQYXR0ZXJuXCI6IHtcbiAgICAgICAgXCJzb3VyY2VcIjogW1xuICAgICAgICAgIFwiYXdzLnMzXCIsXG4gICAgICAgIF0sXG4gICAgICAgIFwiZGV0YWlsXCI6IHtcbiAgICAgICAgICBcImV2ZW50TmFtZVwiOiBbXG4gICAgICAgICAgICBcIlB1dE9iamVjdFwiLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgXCJyZXNvdXJjZXNcIjoge1xuICAgICAgICAgICAgXCJBUk5cIjogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJGbjo6Sm9pblwiOiBbXG4gICAgICAgICAgICAgICAgICBcIlwiLFxuICAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICBcImFybjpcIixcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgIFwiUmVmXCI6IFwiQVdTOjpQYXJ0aXRpb25cIixcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgXCI6czM6OjpNeUJ1Y2tldFwiLFxuICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIFwiU3RhdGVcIjogXCJFTkFCTEVEXCIsXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoXCJvbkNsb3VkVHJhaWxQdXRPYmplY3QgY29udGFpbnMgdGhlIHBhdGggd2hlbiBpdCdzIHByb3ZpZGVkXCIsICgpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgICBjb25zdCBidWNrZXQgPSBzMy5CdWNrZXQuZnJvbUJ1Y2tldEF0dHJpYnV0ZXMoc3RhY2ssICdCdWNrZXQnLCB7XG4gICAgICBidWNrZXROYW1lOiAnTXlCdWNrZXQnLFxuICAgIH0pO1xuICAgIGJ1Y2tldC5vbkNsb3VkVHJhaWxQdXRPYmplY3QoJ1B1dFJ1bGUnLCB7XG4gICAgICB0YXJnZXQ6IHtcbiAgICAgICAgYmluZDogKCkgPT4gKHsgYXJuOiAnQVJOJywgaWQ6ICcnIH0pXG4gICAgICB9LFxuICAgICAgcGF0aHM6IFsnbXkvcGF0aC56aXAnXVxuICAgIH0pO1xuXG4gICAgZXhwZWN0KHN0YWNrKS50b0hhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6RXZlbnRzOjpSdWxlJywge1xuICAgICAgXCJFdmVudFBhdHRlcm5cIjoge1xuICAgICAgICBcInNvdXJjZVwiOiBbXG4gICAgICAgICAgXCJhd3MuczNcIixcbiAgICAgICAgXSxcbiAgICAgICAgXCJkZXRhaWxcIjoge1xuICAgICAgICAgIFwiZXZlbnROYW1lXCI6IFtcbiAgICAgICAgICAgIFwiUHV0T2JqZWN0XCIsXG4gICAgICAgICAgXSxcbiAgICAgICAgICBcInJlc291cmNlc1wiOiB7XG4gICAgICAgICAgICBcIkFSTlwiOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcIkZuOjpKb2luXCI6IFtcbiAgICAgICAgICAgICAgICAgIFwiXCIsXG4gICAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgIFwiYXJuOlwiLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgXCJSZWZcIjogXCJBV1M6OlBhcnRpdGlvblwiLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBcIjpzMzo6Ok15QnVja2V0L215L3BhdGguemlwXCJcbiAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBcIlN0YXRlXCI6IFwiRU5BQkxFRFwiLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KFwib25DbG91ZFRyYWlsV3JpdGVPYmplY3QgbWF0Y2hlcyBvbiBldmVudHMgQ29tcGxldGVNdWx0aXBhcnRVcGxvYWQsIENvcHlPYmplY3QsIGFuZCBQdXRPYmplY3RcIiwgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICAgIGNvbnN0IGJ1Y2tldCA9IHMzLkJ1Y2tldC5mcm9tQnVja2V0QXR0cmlidXRlcyhzdGFjaywgJ0J1Y2tldCcsIHtcbiAgICAgIGJ1Y2tldE5hbWU6ICdNeUJ1Y2tldCcsXG4gICAgfSk7XG4gICAgYnVja2V0Lm9uQ2xvdWRUcmFpbFdyaXRlT2JqZWN0KCdPbkNsb3VkVHJhaWxXcml0ZU9iamVjdFJ1bGUnLCB7XG4gICAgICB0YXJnZXQ6IHtcbiAgICAgICAgYmluZDogKCkgPT4gKHsgYXJuOiAnQVJOJywgaWQ6ICcnIH0pXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBleHBlY3Qoc3RhY2spLnRvSGF2ZVJlc291cmNlTGlrZSgnQVdTOjpFdmVudHM6OlJ1bGUnLCB7XG4gICAgICBcIkV2ZW50UGF0dGVyblwiOiB7XG4gICAgICAgIFwic291cmNlXCI6IFtcbiAgICAgICAgICBcImF3cy5zM1wiLFxuICAgICAgICBdLFxuICAgICAgICBcImRldGFpbFwiOiB7XG4gICAgICAgICAgXCJldmVudE5hbWVcIjogW1xuICAgICAgICAgICAgXCJDb21wbGV0ZU11bHRpcGFydFVwbG9hZFwiLFxuICAgICAgICAgICAgXCJDb3B5T2JqZWN0XCIsXG4gICAgICAgICAgICBcIlB1dE9iamVjdFwiLFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgXCJTdGF0ZVwiOiBcIkVOQUJMRURcIixcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnb25DbG91ZFRyYWlsV3JpdGVPYmplY3QgbWF0Y2hlcyBvbiB0aGUgcmVxdWVzdFBhcmFtZXRlciBidWNrZXROYW1lIHdoZW4gdGhlIHBhdGggaXMgbm90IHByb3ZpZGVkJywgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICAgIGNvbnN0IGJ1Y2tldCA9IHMzLkJ1Y2tldC5mcm9tQnVja2V0QXR0cmlidXRlcyhzdGFjaywgJ0J1Y2tldCcsIHtcbiAgICAgIGJ1Y2tldE5hbWU6ICdNeUJ1Y2tldCcsXG4gICAgfSk7XG4gICAgYnVja2V0Lm9uQ2xvdWRUcmFpbFdyaXRlT2JqZWN0KCdPbkNsb3VkVHJhaWxXcml0ZU9iamVjdFJ1bGUnLCB7XG4gICAgICB0YXJnZXQ6IHtcbiAgICAgICAgYmluZDogKCkgPT4gKHsgYXJuOiAnQVJOJywgaWQ6ICcnIH0pXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgZXhwZWN0KHN0YWNrKS50b0hhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6RXZlbnRzOjpSdWxlJywge1xuICAgICAgXCJFdmVudFBhdHRlcm5cIjoge1xuICAgICAgICBcInNvdXJjZVwiOiBbXG4gICAgICAgICAgXCJhd3MuczNcIixcbiAgICAgICAgXSxcbiAgICAgICAgXCJkZXRhaWxcIjoge1xuICAgICAgICAgIFwicmVxdWVzdFBhcmFtZXRlcnNcIjoge1xuICAgICAgICAgICAgXCJidWNrZXROYW1lXCI6IFtcbiAgICAgICAgICAgICAgYnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KFwib25DbG91ZFRyYWlsV3JpdGVPYmplY3QgbWF0Y2hlcyBvbiB0aGUgcmVxdWVzdFBhcmFtZXRlcnMgYnVja2V0TmFtZSBhbmQga2V5IHdoZW4gdGhlIHBhdGggaXMgcHJvdmlkZWRcIiwgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICAgIGNvbnN0IGJ1Y2tldCA9IHMzLkJ1Y2tldC5mcm9tQnVja2V0QXR0cmlidXRlcyhzdGFjaywgJ0J1Y2tldCcsIHtcbiAgICAgIGJ1Y2tldE5hbWU6ICdNeUJ1Y2tldCcsXG4gICAgfSk7XG4gICAgYnVja2V0Lm9uQ2xvdWRUcmFpbFdyaXRlT2JqZWN0KCdPbkNsb3VkVHJhaWxXcml0ZU9iamVjdFJ1bGUnLCB7XG4gICAgICB0YXJnZXQ6IHtcbiAgICAgICAgYmluZDogKCkgPT4gKHsgYXJuOiAnQVJOJywgaWQ6ICcnIH0pXG4gICAgICB9LFxuICAgICAgcGF0aHM6IFsnbXkvcGF0aC56aXAnXVxuICAgIH0pO1xuXG4gICAgZXhwZWN0KHN0YWNrKS50b0hhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6RXZlbnRzOjpSdWxlJywge1xuICAgICAgXCJFdmVudFBhdHRlcm5cIjoge1xuICAgICAgICBcInNvdXJjZVwiOiBbXG4gICAgICAgICAgXCJhd3MuczNcIixcbiAgICAgICAgXSxcbiAgICAgICAgXCJkZXRhaWxcIjoge1xuICAgICAgICAgIFwicmVxdWVzdFBhcmFtZXRlcnNcIjoge1xuICAgICAgICAgICAgXCJidWNrZXROYW1lXCI6IFtcbiAgICAgICAgICAgICAgYnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgXCJrZXlcIjogW1xuICAgICAgICAgICAgICBcIm15L3BhdGguemlwXCIsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19